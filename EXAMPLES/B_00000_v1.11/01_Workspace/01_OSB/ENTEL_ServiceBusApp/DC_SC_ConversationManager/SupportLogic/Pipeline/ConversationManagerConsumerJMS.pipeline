<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
    <con:coreEntry>
        <con:binding type="Any XML"/>
        <con:xqConfiguration>
            <con:snippetVersion>1.0</con:snippetVersion>
        </con:xqConfiguration>
    </con:coreEntry>
    <con:router errorHandler="error-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7f3f">
        <con:pipeline type="request" name="request-N53ee3fb0.5fd481b9.0.152cb7df2eb.N8000">
            <con:stage id="_StageId-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7ffe" name="Consumer Decision">
                <con:context/>
                <con:actions>
                    <con1:assign varName="ConvOperation">
                        <con2:id>_ActionId-N53e3d830.N16d9ed4.0.15365bc45e1.N7d7b</con2:id>
                        <con1:expr>
                            <con2:xqueryText>if(exists($body/*[1]/*:P_STATUS)) then
&lt;op>upd&lt;/op> (:: updConversationStatus ::)
else
&lt;op>put&lt;/op> (:: getNewConversation ::)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7fff"/>
        <con:pipeline type="error" name="error-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7f3f">
            <con:stage id="_StageId-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7f3e" name="Error Handler">
                <con:context/>
                <con:actions>
                    <con3:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/typesystem/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con5="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7ed6</con2:id>
                        <con3:service ref="DC_SC_ErrorManager/SupportAPI/Proxy/ErrorManager" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>handle</con3:operation>
                        <con3:request>
                            <con3:body wrapped="false">HandleREQ</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body wrapped="false">HandleRSP</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="HandleREQ">
                                <con2:id>_ActionId-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7ed5</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="SR_Commons/XQuery/SupportComponent/ErrorManager/get_handleREQ_v2"/>
                                        <con2:param name="messageHeader">
                                            <con2:path>$body/*[1]/*[3]/*[1]/*[1]</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceErrorCode">
                                            <con2:path>data($fault/ctx:errorCode)</con2:path>
                                        </con2:param>
                                        <con2:param name="errorPlaceHolderPlace">
                                            <con2:path>fn-bea:serialize($fault/ctx:location)</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceErrorDesc">
                                            <con2:path>data($fault/ctx:reason)</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceFault">
                                            <con2:path>$fault</con2:path>
                                        </con2:param>
                                        <con2:param name="errorIndexSubModule">
                                            <con2:path>$operation</con2:path>
                                        </con2:param>
                                        <con2:param name="errorPlaceHolderTime">
                                            <con2:path>current-dateTime()</con2:path>
                                        </con2:param>
                                        <con2:param name="errorIndexModule">
                                            <con2:path>'ConversationManager'</con2:path>
                                        </con2:param>
                                        <con2:param name="errorSourceDetails">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="componentOperation">
                                            <con2:path>$operation</con2:path>
                                        </con2:param>
                                        <con2:param name="errorSourceID">
                                            <con2:path>'FRW'</con2:path>
                                        </con2:param>
                                        <con2:param name="componentName">
                                            <con2:path>'ConversationManager'</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform/>
                    </con3:wsCallout>
                    <con6:alert xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con6="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con5="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7ea1</con2:id>
                        <con6:destination ref="SR_Commons/AlertDestinations/FW_Support"/>
                        <con6:description>Framework - Conversation Manager Failure.</con6:description>
                        <con6:severity>major</con6:severity>
                        <con6:payload>
                            <con2:xqueryTransform>
                                <con2:resource ref="SR_Commons/XQuery/get_MailMessageContent_AlertFW"/>
                                <con2:param name="mailFooter">
                                    <con2:path>''</con2:path>
                                </con2:param>
                                <con2:param name="componentType">
                                    <con2:path>'Support Component'</con2:path>
                                </con2:param>
                                <con2:param name="mailBody">
                                    <con2:path>fn-bea:serialize($fault)</con2:path>
                                </con2:param>
                                <con2:param name="messageHeader">
                                    <con2:path>$body/*[1]/*[1]/*[1]/*[1]</con2:path>
                                </con2:param>
                                <con2:param name="componentOperation">
                                    <con2:path>$operation</con2:path>
                                </con2:param>
                                <con2:param name="componentName">
                                    <con2:path>'ConversationManager'</con2:path>
                                </con2:param>
                                <con2:param name="mailHeader">
                                    <con2:path>'Error Inesperado durante la ejecucion del Conversation Manager JMS Consumer'</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con6:payload>
                    </con6:alert>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="Conversation Consumer">
                <con:request>request-N53ee3fb0.5fd481b9.0.152cb7df2eb.N8000</con:request>
                <con:response>response-N53ee3fb0.5fd481b9.0.152cb7df2eb.N7fff</con:response>
            </con:pipeline-node>
            <con:branch-node type="condition" id="_FlowId-N53e3d830.N16d9ed4.0.15365bc45e1.N7d49" name="Select Operation">
                <con:context/>
                <con:branch-table variable="ConvOperation">
                    <con:xpath>
                        <con2:xpathText>.</con2:xpathText>
                    </con:xpath>
                    <con:branch name="upd">
                        <con:operator>equals</con:operator>
                        <con:value>'upd'</con:value>
                        <con:flow>
                            <con:route-node name="Call - updateConversationStatusAdapter">
                                <con:context/>
                                <con:actions>
                                    <con4:route>
                                        <con2:id>_ActionId-N53e3d830.N16d9ed4.0.15365bc45e1.N7d46</con2:id>
                                        <con4:service ref="DC_SC_ConversationManager/SupportLogic/JCA/updateConversationStatusAdapter/updateConversationStatusAdapter" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con4:operation>updateConversationManagerAdapter</con4:operation>
                                        <con4:outboundTransform/>
                                        <con4:responseTransform/>
                                    </con4:route>
                                </con:actions>
                            </con:route-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="put">
                        <con:operator>equals</con:operator>
                        <con:value>'put'</con:value>
                        <con:flow>
                            <con:route-node name="Call - putConversationStatusAdapter">
                                <con:context/>
                                <con:actions>
                                    <con4:route>
                                        <con2:id>_ActionId-N53e3d830.N16d9ed4.0.15365bc45e1.N7caf</con2:id>
                                        <con4:service ref="DC_SC_ConversationManager/SupportLogic/JCA/putConversationStatusAdapter/putConversationStatusAdapter" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con4:operation>putConversationStatusAdapter</con4:operation>
                                        <con4:outboundTransform/>
                                        <con4:responseTransform/>
                                    </con4:route>
                                </con:actions>
                            </con:route-node>
                        </con:flow>
                    </con:branch>
                    <con:default-branch>
                        <con:flow/>
                    </con:default-branch>
                </con:branch-table>
            </con:branch-node>
        </con:flow>
    </con:router>
</con:pipelineEntry>